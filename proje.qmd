---
title: "TÜRKİYE'DEKİ İKİNCİ EL ARAÇ İLANLARI ÜZERİNE VERİ ANALİZİ"
number-sections: true
code-fold: true
---
![](images/484681339013201.gif)

**Proje sayfamıza hoş geldiniz.**

*Projemizle ilgili güncellemelerden haberdar olmak için bu alanı takip edin.*

# Proje Genel Bakış ve Kapsamı

Bu çalışma, 2025 yılı Türkiye ikinci el otomobil pazarı verilerini kullanarak marka ve şehir bazlı benchmark analizi, kapsamlı keşifsel veri analizi (EDA) ve fiyat tahminlemesi (forecasting) gerçekleştirmeyi amaçlamaktadır. Kod, anlatı ve görseller Quarto ile tekrar üretilebilir biçimde hazırlanmıştır.

# Veri

1.Veri Seti: İkinci el araç ilan verisi (Cars.csv)

2.Coğrafi Veri: Türkiye illeri shapefile (tr.shp)

## Veri Kaynağı

-   <https://www.kaggle.com/datasets/bahridgr/used-car-prices-in-trkiye-2025-entr>

## Veri Hakkında Genel Bilgiler

-Toplam: 6675 satır, 23 sütun

-Temel sütunlar: city, brand, model, price, mileage, engine_power, fuel_type, transmission_type, body_type, accident_history

-Veride eksik gözlemler bulunmakta olup analiz öncesinde ön işlemden geçirilmiştir.

## Tercih Sebebi

-Türkiye merkezli gerçek dünya verisi olması

-Araç pazarı ile ilgili güçlü içgörüler barındırması

-Fiyat tahminlemesi gibi uygulamalara uygun olması

-Zengin sayısal ve kategorik değişkenlere sahip olması sayesinde istatistiksel analiz ve görselleştirmeye uygun olması

## Veri Ön İşleme

### Kütüphanelerin Yüklenmesi

```{r output=FALSE}
library(tidyverse)     # dplyr, ggplot2, readr, tidyr, stringr, purrr, forcats
library(janitor)       # Sütun isimlerini temizleme
library(naniar)        # Eksik değer görselleştirme
library(scales)        # Etiket biçimlendirme (label_number vs.)
library(lubridate)     # Tarih işleme
library(caret)         # Modelleme ve veri bölme
library(randomForest)  # Rastgele orman modeli
library(vip)           # Değişken önem grafikleri
library(sf)            # Shapefile okuma ve coğrafi veri
library(leaflet)       # İnteraktif harita
library(TRmaps)        # Türkiye il haritası
library(stringi)       # Türkçe karakter dönüştürme için

```

### Veri Okuma ve Temizlik

```{r message=FALSE, warning=FALSE }


# Veriyi oku
cars <- read_csv("csv/Cars.csv") %>% clean_names()

# Tüm karakter sütunlarında \n, \r, \t, _x000D_ gibi ifadeleri temizle
clean_text_columns <- function(df) {
  df %>%
    mutate(across(where(is.character), ~ gsub("\\n|\\r|\\t|_x000D_", " ", .))) %>%
    mutate(across(where(is.character), ~ str_trim(.)))
}

# Temizleme fonksiyonunu uygula
cars <- clean_text_columns(cars)

# Silinecek sütunlar
drop_list <- c("listing_title", "listing_id")

# Sütunları çıkar ve tekrarlayan satırları sil
cars <- cars %>%
  select(-all_of(drop_list)) %>%
  distinct()

# Araç yaşı hesapla
cars <- cars %>%
  mutate(
    year_clean = as.numeric(year),
    age = 2025 - year_clean
  )

# car_data'nın ilk 10 satırını tablo olarak bastır
knitr::kable(head(cars, 10), caption = "Hazırlanan Veri Setinin İlk 10 Satırı")


```

### Eksik Verilerin Doldurulması

```{r output=FALSE}

# Mod hesaplama fonksiyonu
mode_impute <- function(x) {
  ux <- na.omit(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Sayısal sütunları medyanla doldur
cars <- cars %>%
  mutate(
    mileage_clean = ifelse(is.na(mileage_clean), median(mileage_clean, na.rm = TRUE), mileage_clean),
    engine_power_clean = ifelse(is.na(engine_power_clean), median(engine_power_clean, na.rm = TRUE), engine_power_clean),
    year_clean = ifelse(is.na(year_clean), median(year_clean, na.rm = TRUE), year_clean)
  )

# Kategorik sütunları mod ile doldur
categorical_cols <- c("fuel_type", "transmission_type", "seller_type", "accident_history", "color", "drive_train", "body_type")
for (col in categorical_cols) {
  cars[[col]][is.na(cars[[col]])] <- mode_impute(cars[[col]])
}

# Sayıları karakter içinden ayıkla ve sayıya çevir
cars <- cars %>%
  mutate(
    engine_power_hp = str_extract(engine_power_hp, "\\d+") %>% as.numeric(),
    engine_size_clean = str_extract(engine_size_clean, "\\d+") %>% as.numeric(),
    engine_size_cc = parse_number(as.character(engine_size_cc))
  )

# engine_power_hp ve engine_size sütunlarını marka-model bazlı doldur
cars <- cars %>%
  group_by(brand, model) %>%
  mutate(
    engine_power_hp = ifelse(is.na(engine_power_hp), round(mean(engine_power_hp, na.rm = TRUE)), engine_power_hp),
    engine_size_clean = ifelse(is.na(engine_size_clean), round(mean(engine_size_clean, na.rm = TRUE)), engine_size_clean),
    engine_size_cc = ifelse(is.na(engine_size_cc), round(mean(engine_size_cc, na.rm = TRUE)), engine_size_cc)
  ) %>%
  ungroup()

# Kalan NA’lar için genel medyanla doldurma
cars <- cars %>%
  mutate(
    engine_power_hp = ifelse(is.na(engine_power_hp), median(engine_power_hp, na.rm = TRUE), engine_power_hp),
    engine_size_clean = ifelse(is.na(engine_size_clean), median(engine_size_clean, na.rm = TRUE), engine_size_clean),
    engine_size_cc = ifelse(is.na(engine_size_cc), median(engine_size_cc, na.rm = TRUE), engine_size_cc)
  )

# Eksik year varsa marka-model ortalaması ile doldur
cars <- cars %>%
  group_by(brand, model) %>%
  mutate(year = ifelse(is.na(year), round(mean(year, na.rm = TRUE)), year)) %>%
  ungroup()

# Araç yaşını yeniden güncelle
cars <- cars %>%
  mutate(age = 2025 - year)

# Kullanılmayan sütunları kaldır
cars <- cars %>%
  select(-any_of(c("vehicle_tax_try", "trade_in_available")))

# Kritik alanlarda eksik varsa o satırları sil
cars <- cars %>%
  filter(!is.na(year), !is.na(model), !is.na(age))

# Eksik değerleri görselleştir
gg_miss_var(cars)

```

```{r output=FALSE}

cars %>%
  summarise(across(everything(), ~ sum(is.na(.)))) %>%
  pivot_longer(cols = everything(), names_to = "değişken", values_to = "eksik_sayı") %>%
  filter(eksik_sayı > 0) %>%
  arrange(desc(eksik_sayı))

```

# Analiz

## Keşifsel Veri Analizi

```{r }
cars %>%
  summarise(
    mean_price = mean(price_clean, na.rm = TRUE),
    mean_km = mean(mileage_clean, na.rm = TRUE),
    mean_hp = mean(engine_power_clean, na.rm = TRUE)
  )
```

Bu da demektir ki veri setindeki ikinci el araçların ortalama:

Fiyatı yaklaşık 787.000 TL

Kilometresi 217.000 km

Motor gücü 108 HP

### Marka Bazlı Ortalama Fiyat Dağılımı

```{r, message=FALSE, warning=FALSE}
# Marka bazlı ortalama fiyat ve ilan sayısı
brand_summary <- cars %>%
  group_by(brand) %>%
  summarise(
    mean_price = mean(price_clean, na.rm = TRUE),
    count = n()
  ) %>%
  filter(count > 30) %>%  # Çok az gözleme sahip markaları filtrele (isteğe bağlı)
  arrange(desc(mean_price))

# Görselleştirme
ggplot(brand_summary, aes(x = reorder(brand, mean_price), y = mean_price)) +
  geom_col(fill = "darkblue") +
  coord_flip() +
  scale_y_continuous(labels = label_number(suffix = " TL", big.mark = ".", decimal.mark = ",")) +
  labs(
    title = "Markalara Göre Ortalama Araç Fiyatları",
    x = "Marka",
    y = "Ortalama Fiyat (TL)"
  ) +
  theme_minimal(base_size = 14)

```

Markalara Göre Ortalama Araç Fiyatları

Mercedes-Benz, açık ara farkla en yüksek ortalama ikinci el araç fiyatına sahip markadır. Bu, markanın genellikle lüks segmentte konumlanmasından ve daha yeni modellerin piyasada yoğun olmasından kaynaklanıyor olabilir.

Onu Audi ve BMW takip etmektedir. Bu üç marka, genellikle premium algısı olan ve fiyat aralığı yüksek modeller sunan üreticilerdir.

Honda, Volkswagen ve Toyota gibi markalar orta segmentte konumlanırken; Fiat, Renault, Opel gibi markalar ise genellikle daha erişilebilir fiyatlara sahip modelleriyle öne çıkmaktadır.

Listenin alt sıralarında yer alan markalar, daha uygun fiyatlı ve/veya daha eski model araçlara sahip olabilirler.

### Vites Tipine Göre Fiyat
```{r, message=FALSE, warning= FALSE }
cars %>%
  filter(!is.na(transmission_type), !is.na(price_clean), price_clean > 0) %>%
  ggplot(aes(x = transmission_type, y = log10(price_clean))) +
  geom_boxplot(fill = "lightgreen", outlier.color = "darkred", outlier.size = 1.2) +
  labs(
    title = "Vites Tipine Göre Log10(Fiyat) Dağılımı",
    x = "Vites Tipi",
    y = "log10(Fiyat) (TL)"
  ) +
  theme_minimal()
```

 Vites Tipine Göre Fiyat Dağılımı<br>
 
 Automatic<br>
 Medyan (orta çizgi) log10(fiyat) değeri en yüksek olan grup.
 Fiyat dağılımı geniş ve üst uçta birçok lüks fiyatlı araç (outlier) mevcut.
 Bu, otomatik vitesli araçların genelde daha pahalı olduğunu ve aralarında lüks segmentlerin de bulunduğunu    gösterir.

 Manual<br>
 Medyan fiyatı en düşük olan grup.
 Dağılım daha dar ve genellikle düşük fiyatlı araçlar bu grupta yer alıyor.
 Daha az lüks model içeren ekonomik seçeneklerin bu grupta yoğunlaştığı anlaşılıyor.

 Semi-Automatic<br>
 Medyan değeri, otomatikten düşük ama manuele göre daha yüksek.
 Yayılım dar, yani fiyatlar bu grupta daha homojen.
 Genellikle orta segmentte yer alan araçlar bu grupta olabilir.

```{r, message=FALSE, warning=FALSE}
# Önce city_stats oluştur
city_stats <- cars %>%
  filter(!is.na(city), !is.na(price_clean)) %>%
  group_by(city) %>%
  summarise(
    mean_price = mean(price_clean, na.rm = TRUE),
    count = n()
  )

# Bar chart
city_stats %>%
  filter(count >= 30) %>%
  ggplot(aes(x = fct_reorder(city, mean_price), y = mean_price)) +
  geom_col(fill = "darkcyan", width = 0.7) +
  coord_flip() +
  scale_y_continuous(
    labels = label_number(suffix = " TL", big.mark = ".", decimal.mark = ","),
    expand = expansion(mult = c(0, 0.1))
  ) +
  labs(
    title = "Ortalama Fiyatı En Yüksek Şehirler (Min. 30 İlan)",
    x = "Şehir",
    y = "Ortalama Fiyat"
  ) +
  theme_minimal(base_size = 10)

```

```{r, message=FALSE, warning=FALSE}

# Ortalama ve Medyan Fiyatları Hazırla
fiyat_ozet <- cars %>%
  filter(!is.na(city), !is.na(price_clean)) %>%
  group_by(city) %>%
  filter(n() >= 30) %>%
  summarise(
    Ortalama = mean(price_clean, na.rm = TRUE),
    Medyan = median(price_clean, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = c("Ortalama", "Medyan"), names_to = "FiyatTürü", values_to = "Fiyat") %>%
  mutate(city = fct_reorder(city, Fiyat))

# Facet Wrap ile Görselleştir
ggplot(fiyat_ozet, aes(x = city, y = Fiyat)) +
  geom_col(fill = "darkcyan") +
  coord_flip() +
  facet_wrap(~ FiyatTürü, scales = "free_x") +
  scale_y_continuous(labels = label_number(suffix = " TL", big.mark = ".", decimal.mark = ",")) +
  labs(
    title = "Şehir Bazlı Ortalama ve Medyan Fiyat Karşılaştırması",
    x = "Şehir",
    y = "Fiyat"
  ) +
  theme_minimal(base_size = 9)


```

Türkiye genelinde medyan fiyat açısından Muğla, yaklaşık 780 000 TL ile birinci sırada yer alırken, İstanbul 770 000 TL civarıyla ikinci ve Batman 760 000 TL dolaylarıyla üçüncü konumda bulunuyor. Ortalama fiyatlarda ise İstanbul, yaklaşık 1 150 000 TL ile açık ara liderliğini koruyor; Muğla (≈ 950 000 TL) ve Antalya (≈ 900 000 TL) ise İstanbul’u izliyor. Bu durum, pazardaki yüksek fiyatlı ilanların ortalamayı ciddi biçimde yukarı çektiğini gösteriyor.

Turistik destinasyonlar başta olmak üzere Muğla ve Antalya’da hem medyan hem de ortalama fiyatların görece yüksek olması, Bodrum, Fethiye ve Marmaris gibi ilçelere yönelik güçlü talebin ve bölge ekonomisinin ikinci el piyasasını üst segmente doğru kaydırdığını ortaya koyuyor. İstanbul ise büyük metropol olmanın getirdiği nüfus yoğunluğu, iş imkânları ve lüks araç arz-talep dengesiyle ortalama fiyat bakımından zirvede yer alıyor.

Ortalama ve medyan arasındaki farkın İstanbul’da yaklaşık 380 000 TL, Muğla’da ise 170 000 TL civarında seyretmesi, bu illerdeki pahalı ilan hacminin fazlalığına işaret ediyor. Yani yüksek gelir grubuna mensup alıcılar bu piyasalarda belirgin ağırlıkta.

Medyanı 600–700 000 TL arasında değişen Konya, Mersin, Adana ve Sakarya gibi iller geniş bir kitleye hitap ederken, fiyatların ne aşırı oynak ne de tamamen durağan olduğu dengeli bir pazar yapısı sunuyor. Öte yandan Kahramanmaraş, Zonguldak, Yozgat, Sivas ve Çorum’da hem medyan hem de ortalama fiyatlar 500 000 TL’nin altında seyrediyor. Uç fiyat ilanlarının nispeten sınırlı kaldığı bu bölgeler daha “ölçülü” bir piyasa yapısına sahip.

Genel olarak, medyan fiyatın yüksek olduğu bir ilde tipik bir satışın bile ülke ortalamasının üstünde gerçekleştiği; düşük medyanlı bölgelerde ise çoğu ilanın makul sınırlarda seyrettiği söylenebilir. 

Yatırım ya da satın alma stratejisi belirlenirken, uç fiyatların yanıltıcı etkisinden kaçınmak için ortalama yerine medyan değere odaklanmak daha gerçekçi bir bakış açısı sağlayacaktır. Ayrıca, medyan değeri yüksek ancak ortalama ile arasındaki makasın görece dar olduğu Batman veya Diyarbakır gibi iller, lüks segmente kapı aralarken aşırı fiyat dalgalanmalarından da uzak kalmak isteyen alıcılar için cazip seçenekler sunabilir.


### Türkiye’deki illerin ortalama ikinci el araç fiyatlarının harita üzerinde gösterimi

```{r, message=FALSE, warning=FALSE}

# Türkiye shapefile'ını oku
turkiye_il <- st_read("csv/tr_shp/tr.shp", quiet = TRUE)

# Türkçe karakterleri düzleştiren yardımcı fonksiyon
normalize_city <- function(x) {
  x %>%
    stri_trans_general("Latin-ASCII") %>% # Türkçe karakterleri dönüştür (İ→I, Ş→S, Ü→U)
    toupper() %>%
    trimws()
}

# Ortalama fiyatları hesapla (ilan sayısı 30'dan büyük olanlar)
fiyatlar <- cars %>%
  filter(!is.na(city), !is.na(price_clean)) %>%
  group_by(city) %>%
  summarise(
    mean_price = mean(price_clean, na.rm = TRUE),
    ilan_sayisi = n()
  ) %>%
  filter(ilan_sayisi >= 30) %>%
  mutate(city_clean = normalize_city(city))

# Harita verisini temizle
turkiye_il <- turkiye_il %>%
  mutate(city_clean = normalize_city(name))  # name yerine IL_ADI kullanıyorsan onu yaz

# Join işlemi
turkiye_il <- turkiye_il %>%
  left_join(fiyatlar, by = "city_clean")

# Harita paleti
pal <- colorNumeric(palette = "YlOrRd", domain = turkiye_il$mean_price, na.color = "gray90")

# Harita çizimi
leaflet(data = turkiye_il) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(mean_price),
    weight = 1,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    label = ~paste0(name, ": ₺", format(round(mean_price), big.mark = ".", decimal.mark = ",")),
    highlightOptions = highlightOptions(
      weight = 3,
      color = "#666",
      fillOpacity = 0.9,
      bringToFront = TRUE
    )
  ) %>%
  addLegend(pal = pal, values = ~mean_price, opacity = 0.7,
            title = "Ortalama Fiyat (₺)",
            position = "bottomright")

```

### Yakıt Tipine Göre Medyan Araç Fiyatları

```{r, message=FALSE, warning=FALSE}
cars %>%
  group_by(fuel_type) %>%
  summarise(median_price = median(price_clean, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(fuel_type, median_price), y = median_price)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  scale_y_continuous(labels = scales::label_number(suffix = " TL", big.mark = ".", decimal.mark = ",")) +
  labs(
    title = "Yakıt Tipine Göre Medyan Araç Fiyatları",
    x = "Yakıt Türü",
    y = "Medyan Fiyat (TL)"
  ) +
  theme_minimal(base_size = 13)
```

Bu grafikte, Türkiye’deki ikinci el araç pazarında kullanılan yakıt türlerinin ortalama araç fiyatlarına etkisi incelenmektedir <br>

 Benzinli Araçlar <br>
En yaygın yakıt türlerinden biridir.

Ortalama fiyatı genellikle orta seviyede kalmaktadır.

Geniş fiyat aralığına sahip, hem ekonomik hem de premium modellerde tercih edilmektedir.

 Elektrikli Araçlar <br>
Ortalama fiyatı en yüksek olan gruptur.

Bunun nedeni, Türkiye’de elektrikli araçların henüz yaygın olmaması ve çoğunun yeni teknolojiye sahip pahalı modeller olmasıdır.

 Dizel Araçlar <br>
Ortalama fiyatları benzinli araçlara benzer seviyededir ya da biraz daha yüksektir.
Özellikle yüksek kilometreli araçlarda tercih edilse de, motor ömrü uzun olduğu için fiyatları belirli bir seviyede korunmaktadır.

 Hibrit (Hybrid) <br>
Elektrik-benzin kombinasyonuna sahip bu araçlar genelde yeni teknolojiye sahip oldukları için ortalama fiyatları da yüksek çıkmaktadır.
Yakıt tasarrufu ve çevreci özellikleri fiyatlarına yansımaktadır.

## Trend Analizi

### Araç Yaşı ile Fiyat İlişkisi

```{r,message= FALSE, warning= FALSE }

# Outlier'ları filtrele (örnek: 1. ve 99. persentil arası tut)
q_low <- quantile(cars$mileage_clean, 0.01, na.rm = TRUE)
q_high <- quantile(cars$mileage_clean, 0.99, na.rm = TRUE)

cars_filtered <- cars %>%
  filter(
    mileage_clean >= q_low,
    mileage_clean <= q_high,
    price_clean <= quantile(price_clean, 0.99, na.rm = TRUE)
  )

# Grafik
ggplot(data = cars_filtered, aes(x = mileage_clean, y = price_clean)) +
  geom_point(color = "mediumorchid", alpha = 0.4) +
  geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 1.1) +
  labs(
    title = "Kilometre ile Fiyat Arasındaki İlişki (Outlier'sız)",
    x = "Kilometre",
    y = "Fiyat (TL)"
  ) +
scale_y_continuous(labels = label_number(big.mark = ".", decimal.mark = ",", suffix = " TL")) +
scale_x_continuous(labels = label_number(big.mark = ".", decimal.mark = ",", suffix = " km"))
  invisible(theme_minimal())

```

Negatif Korelasyon (Eğim Azalan):

Siyah çizgi (regresyon doğrusu), kilometre arttıkça araç fiyatının azaldığını gösteriyor.

Bu beklenen bir sonuç: Daha fazla kullanılmış (yüksek km’li) araçlar genellikle daha ucuz.

Veri Dağılımı:

0–50.000 km arası araçlar daha yüksek fiyatlara sahip. Fiyat 3.000.000 TL'ye kadar çıkabiliyor.

150.000 km’den sonra fiyatlar genellikle 1.000.000 TL'nin altına düşüyor.

Yoğunluk:

En yoğun noktalar (mor kümeler) 50.000 – 150.000 km arası ve 500.000 – 1.500.000 TL fiyat aralığında toplanıyor.

Bu da piyasadaki en yaygın ikinci el araç kitlesini gösteriyor.

Aykırı Değerlerin Etkisi Azalmış:

İlk grafiğe göre çok uç fiyatlar (\>30.000.000 TL gibi) çıkarıldığı için regresyon çizgisi daha gerçekçi bir eğilim gösteriyor.

Kilometre arttıkça araç fiyatı genellikle düşmektedir. Özellikle 150.000 km üzerindeki araçlar belirgin şekilde daha ucuzdur. Ancak düşük kilometreli araçların fiyatları çok değişken olup bazı modellerde yüksek fiyatlara ulaşabilmektedir.

### Araç Yaşı ve Ortalama Fiyat

```{r, message=FALSE, warning=FALSE }
cars %>%
  group_by(age) %>%
  summarise(mean_price = mean(price_clean, na.rm = TRUE)) %>%
  ggplot(aes(x = age, y = mean_price)) +
  geom_line(color = "red", size = 1.2) +
  geom_point(color = "black") +
  scale_x_continuous(breaks = pretty_breaks()) +
  scale_y_continuous(labels = label_number(suffix = " Tl", big.mark = ".", decimal.mark = ",")) +
  labs(
    title = "Araç Yaşına Göre Ortalama Fiyat",
    x = "Araç Yaşı",
    y = "Ortalama Fiyat"
  ) +
  theme_minimal()

```

Genel Eğilim (Azalan Trend):

Grafik kırmızı bir çizgiyle, araç yaşı arttıkça ortalama fiyatın düştüğünü net şekilde gösteriyor.

Özellikle 0–5 yaş arası araçlarda fiyatlar oldukça yüksek. Bu yaş aralığında araçlar en yeni ve en pahalı olanlar.

Fiyat Düşüş Hızı:

İlk 3–4 yıl içinde fiyatlar daha hızlı düşerken, 7 yaşından sonra düşüş hızı yavaşlıyor ve daha durağan hale geliyor.

Bu, ikinci el piyasasında ilk yıllarda değer kaybının daha yüksek olduğunu gösteriyor (araba değer kaybı eğrisi).


## Model Uydurma

## Modelin Performansı

### Model için Veri Setinin Hazırlanması

```{r}
# Temizlenmiş veri üzerinden model veri seti oluşturuluyor

car_data <- cars %>%
  filter(
    !is.na(price_clean),
    !is.na(year_clean),
    !is.na(mileage_clean),
    !is.na(engine_power_clean),
    !is.na(fuel_type),
    !is.na(transmission_type),
    !is.na(brand),
    !is.na(body_type)
  ) %>%
  mutate(
    price_log = log10(price_clean),  # log dönüşümü ile daha iyi dağılım
    across(c(fuel_type, transmission_type, brand, body_type), as.factor)
  ) %>%
  select(price_log, year_clean, mileage_clean, engine_power_clean, fuel_type, transmission_type, brand, body_type)

# car_data'nın ilk 10 satırını tablo olarak bastır
knitr::kable(head(car_data, 10), caption = "Modelleme için Hazırlanan Veri Setinin İlk 10 Satırı")

```

### Modelin Eğitilmesi ve Test Edilmesi

```{r message=FALSE, warning=FALSE}
set.seed(123)

split <- createDataPartition(car_data$price_log, p = 0.8, list = FALSE)
train_set <- car_data[split, ]
test_set <- car_data[-split, ]

rf_model <- randomForest(
  price_log ~ ., 
  data = train_set,
  ntree = 100,
  importance = TRUE
)

# Tahmin yap
predicted <- predict(rf_model, newdata = test_set)
actual <- test_set$price_log

# Performans metrikleri (log10 dönüşümlü)
rmse <- sqrt(mean((predicted - actual)^2))
mae <- mean(abs(predicted - actual))

cat("RMSE (log10):", round(rmse, 3), "\n")
cat("MAE (log10):", round(mae, 3), "\n")

# Gerçek ölçekte hata tahmini (yüzdelik)
relative_error <- (10^rmse - 1) * 100
cat("Tahmini Ortalama Hata (%):", round(relative_error, 1), "%")


```

### Tahmin Doğruluğu ve Yorum

-RMSE (log10): 0.071

-MAE (log10): 0.051

-Tahmini Ortalama Hata (%): \~17.8%

Bu sonuçlar, modelin ikinci el araç fiyatlarını oldukça başarılı şekilde tahmin ettiğini göstermektedir. Özellikle ikinci el araç piyasasındaki dalgalanma, marka ve model çeşitliliği göz önüne alındığında, bu hata oranı güçlü bir performansa işaret eder.

Model, fiyatların %80’inden fazlasını gerçek değerin ±%18’lik bir aralığında öngörebilmiştir.

### Önemli Değişkenler

```{r }
vip(rf_model, num_features = 10)

```

### Gerçek Fiyat ile Tahmin Edilen Fiyat Karşılaştırması

```{r, message=FALSE, warning=FALSE}
# Test veri seti üzerinde tahmin yap ve hata metriklerini hesapla
tahmin_df <- test_set %>%
  mutate(
    tahmin_log = predict(rf_model, newdata = .),            # Log10 tahmini
    tahmin_fiyat = 10^tahmin_log,                           # Gerçek ölçekli tahmin
    gercek_fiyat = 10^price_log,                            # Gerçek fiyat (log'dan çıkarıldı)
    hata = abs(tahmin_fiyat - gercek_fiyat),                # Mutlak hata
    hata_orani = round((hata / gercek_fiyat) * 100, 1)      # Yüzde hata
  ) %>%
  select(brand, year_clean, mileage_clean, engine_power_clean,
         fuel_type, transmission_type, body_type,
         gercek_fiyat, tahmin_fiyat, hata, hata_orani)

# En başarılı tahmin edilen 10 örneği görüntüle
  knitr::kable(head(tahmin_df %>% arrange(hata_orani), 10), caption = "En Düşük Hatalı 10 Fiyat Tahmini")


```


### En Çok Fahiş Fiyatlı İlan Bulunan Markalar ve Fahiş İlanlarda Hata Oranı Dağılımı Analizi

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)

# tahmin_df ve test_set için ID ekleme
tahmin_df <- tahmin_df %>%
  mutate(id = row_number())

test_set <- test_set %>%
  mutate(id = row_number())

# Fahiş fiyatlı ilanları belirle (hata oranı > %30)
fahis_df <- tahmin_df %>%
  filter(hata_orani > 30) %>%
  select(id, hata_orani)

# Fahiş ilanların orijinal bilgilerini test_set ile birleştir
fahis_detayli <- test_set %>%
  inner_join(fahis_df, by = "id")

# cars datasından seller_type ve city gibi bilgileri ekleyelim
ilan_fahis_detay <- fahis_detayli %>%
  left_join(cars %>%
              mutate(price_log = log10(price_clean)) %>%
              select(price_log, brand, model, year_clean, mileage_clean, engine_power_clean, city, seller_type),
            by = c("price_log", "brand"))

# Marka bazlı en çok fahiş ilan (Top 10 marka)
marka_fahis <- ilan_fahis_detay %>%
  count(brand, sort = TRUE) %>%
  top_n(10, wt = n)

# Satıcı türüne göre fahiş ilan dağılımı
satici_fahis <- ilan_fahis_detay %>%
  count(seller_type, sort = TRUE)

# Şehir bazında fahiş ilan dağılımı
sehir_fahis <- ilan_fahis_detay %>%
  count(city, sort = TRUE) %>%
  top_n(10, wt = n)


# Görselleştirme (örnek)
ggplot(marka_fahis, aes(x = reorder(brand, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(title = "En Çok Fahiş Fiyatlı İlan Bulunan Markalar", x = "Marka", y = "İlan Sayısı")

ggplot(ilan_fahis_detay, aes(x = hata_orani)) +
  geom_histogram(fill = "tomato", bins = 30) +
  labs(title = "Fahiş İlanlarda Hata Oranı Dağılımı", x = "% Hata", y = "İlan Sayısı")

```

En Çok Fahiş Fiyatlı İlan Bulunan Markalar grafiği, ikinci el araç piyasasında tahmin edilen piyasa değerine kıyasla %30’dan fazla sapma gösteren (yani fahiş fiyatlı olarak nitelendirilebilecek) ilanların, marka bazında dağılımını göstermektedir.

Analiz sonucuna göre, Renault markası en fazla fahiş fiyatlı ilanla ilk sırada yer almakta, onu Fiat ve Opel markaları takip etmektedir. Bu durum, söz konusu markaların Türkiye genelinde yaygın olarak tercih edilmesi ve ikinci el piyasasında yüksek ilan hacmine sahip olmalarıyla ilişkilendirilebilir. Ayrıca, bazı kullanıcıların bu markalara yönelik talep avantajını fırsata çevirmeye çalışarak, piyasa değerinin üzerinde fiyatlandırmalar yaptığı değerlendirilmektedir.

Peugeot, Hyundai ve BMW gibi diğer markalar da fahiş fiyatlı ilanlar açısından dikkat çekmekle birlikte, premium segmentte yer alan Mercedes-Benz ve Audi gibi markalar, daha düşük sayıda fahiş fiyatlı ilanla listenin son sıralarında yer almıştır. Bu durum, yüksek segment araçlarda fiyat algısının daha dengeli oluştuğunu ve piyasa değerinden sapmaların nispeten daha az yaşandığını göstermektedir.

Sonuç olarak, elde edilen bulgular, ikinci el araç piyasasında bazı markalarda piyasa değerinin üzerinde fiyatlandırmaların yoğunlaştığını ortaya koymakta ve bu durumun marka bazında farklılık gösterdiğine işaret etmektedir.

Grafik Yorumu – Fahiş İlanlarda Hata Oranı Dağılımı

%30–50 aralığında hata oranına sahip ilanlar en yoğun grubu oluşturmaktadır. Bu durum, piyasadaki fahiş fiyatlı ilanların büyük çoğunluğunun, piyasa değerine kıyasla %30 ila %50 daha yüksek fiyatlandırıldığını göstermektedir.

Özellikle %35 civarındaki hata oranı, en fazla ilan sayısının gözlendiği bölgeyi temsil etmektedir.

%70 ve üzeri hata oranına sahip ilanlar, çok daha düşük sıklıkta görülmekte olup uç değerleri temsil etmektedir.

%100’ün üzerinde hata oranına sahip az sayıda ilan bulunması, bazı ilanların gerçek piyasa değerinin iki katına varan fiyatlarla listelendiğini ortaya koymaktadır.

### Satıcı Türüne Göre Fahiş Fiyat Eğilimi

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)

# Fahiş fiyatlı ilanları hata oranı > 30 olarak kabul et
fahis_analiz <- tahmin_df %>%
  mutate(price_log = log10(gercek_fiyat)) %>%
  filter(hata_orani > 30) %>%
  left_join(cars %>% 
              mutate(price_log = log10(price_clean)) %>% 
              select(price_log, seller_type),
            by = "price_log")

# Toplam ve fahiş ilan sayısını hesapla
fahis_oran_df <- cars %>%
  count(seller_type, name = "toplam") %>%
  left_join(
    fahis_analiz %>%
      count(seller_type, name = "fahis"),
    by = "seller_type"
  ) %>%
  mutate(
    fahis = replace_na(fahis, 0),
    oran = round((fahis / toplam) * 100, 1)
  )

# Görselleştir
ggplot(fahis_oran_df, aes(x = reorder(seller_type, oran), y = oran)) +
  geom_col(fill = "darkred") +
  coord_flip() +
  labs(
    title = "Satıcı Tipine Göre Fahiş Fiyatlı İlan Oranı",
    x = "Satıcı Tipi",
    y = "Fahiş İlan Oranı (%)"
  ) +
  theme_minimal()


```
Fiyatlar Tahmin Modeline Uygun:
Authorized Dealer ilanları, genellikle profesyonel fiyatlama stratejileri ile yayımlandığından tahmin modelimizin öngördüğü fiyatlara oldukça yakındır. Bu durum, bu grubun fahiş fiyatlı ilan üretme eğiliminin düşük olduğunu göstermektedir.


## Sonuçlar

# Sonuçlar ve Ana Çıkarımlar

1. Türkiye’deki İkinci El Araç Pazarının Genel Yapısı
Veri setindeki ikinci el araçların ortalama fiyatı yaklaşık 787.000 TL, ortalama kilometresi ise 217.000 km olarak belirlenmiştir.

Araçların ortalama motor gücü 108 HP civarındadır.

Bu değerler, Türkiye ikinci el pazarında ağırlıklı olarak orta segment araçların bulunduğuna işaret etmektedir.

2. Marka Bazlı Fiyat Dağılımı
Mercedes-Benz, Audi ve BMW, en yüksek ortalama fiyatlara sahip markalardır; bu durum bu markaların ağırlıklı olarak lüks segmentte yer almasından kaynaklanmaktadır.

Fiat, Renault ve Opel gibi markalar, daha düşük fiyatlı modelleriyle ekonomik segmentte yer almakta; geniş kitlelere hitap etmektedir.

3. Vites Tipine Göre Fiyat Analizi
Otomatik vitesli araçlar, tüm gruplar içinde en yüksek medyan fiyata sahiptir. Bu durum, otomatik araçlara olan talep ve sundukları konforun fiyatlara yansımasını göstermektedir.

Manuel vitesli araçlar, daha düşük fiyatlı ve ekonomik araç grubunu temsil etmektedir.

Yarı otomatik vitesli araçlar, fiyat ve donanım açısından orta segmentte konumlanmaktadır.

4. Yakıt Türüne Göre Fiyat Karşılaştırması
Elektrikli ve hibrit araçlar, en yüksek medyan fiyatlara sahiptir. Bunun başlıca nedeni, bu araçların henüz yaygın olmaması ve piyasada yer alan modellerin çoğunun yeni ve teknolojik açıdan donanımlı olmasıdır.

Dizel ve benzinli araçlar, ortalama fiyat seviyesinde yer almakta; LPG'li araçlar ise en ekonomik seçenekleri oluşturmaktadır.

5. Şehir Bazlı Fiyat Analizi
İstanbul, Muğla ve Antalya, ortalama ve medyan fiyat açısından Türkiye’nin en pahalı ikinci el pazarlarına sahiptir.

Bu şehirlerdeki fiyat düzeyi; turizm, lüks araç talebi ve yüksek gelir gruplarının etkisiyle yükselmektedir.

Batman, Diyarbakır gibi şehirler, medyan fiyat açısından yüksek ancak ortalama ile farkı dar olan dengeli pazarlardır.

Zonguldak, Sivas ve Yozgat gibi şehirler ise düşük fiyat düzeyleriyle ölçülü pazar yapısı sergilemektedir.

6. Araç Yaşı ve Kilometreye Göre Fiyat İlişkisi
Araç yaşı ile fiyat arasında negatif yönlü bir ilişki gözlenmiştir. İlk 3–5 yıl içerisinde araçlar hızlı değer kaybederken, 7 yaşından sonra bu düşüş daha yavaş ilerlemektedir.

Benzer şekilde, kilometre arttıkça fiyatlar düşmektedir. 150.000 km üzeri araçlar, genellikle daha düşük fiyat segmentinde yer almaktadır.

Düşük kilometreli araçların fiyatları ise daha değişken olup, marka ve donanım özelliklerine göre geniş bir fiyat aralığında seyretmektedir.

7. Satıcı Türüne Göre Fiyat Dağılımı
Yetkili satıcılar (Authorized Dealer), en yüksek medyan fiyata sahip olsalar da fiyatlandırmaları oldukça tutarlıdır.

Galericiler (Dealer), fiyat açısından daha geniş bir aralık sunmakta; zaman zaman uç fiyatlandırmalar gözlenmektedir.

Bireysel satıcılar (Private Seller), en düşük medyan fiyata sahip olmakla birlikte fiyat çeşitliliği en yüksek gruptur.

8. Fahiş Fiyatlı İlan Analizi (Hata Oranı > %30)
En çok fahiş fiyatlı ilanlar, Renault, Fiat, Opel ve Hyundai gibi markalarda tespit edilmiştir. Bu durum, bazı satıcıların ekonomik segmentteki araçları piyasa değerinin oldukça üzerinde fiyatlandırdığını göstermektedir.

İstanbul, Ankara, İzmir, Gaziantep ve Bursa, en fazla fahiş fiyatlı ilana sahip şehirlerdir. Bu şehirlerdeki yüksek rekabet ve talep, fiyatların şişirilmesine yol açmaktadır.

Fahiş fiyatlı ilanların büyük çoğunluğu bireysel satıcılar tarafından yayımlanmıştır. Yetkili satıcıların ise bu alanda neredeyse hiç yer almaması, profesyonel fiyatlama politikalarının etkili olduğunu göstermektedir.

9. Fiyat Tahmin Modeli Performansı
Random Forest algoritması kullanılarak geliştirilen fiyat tahmin modeli, log dönüşümlü veri üzerinde aşağıdaki performansı göstermiştir:

RMSE (log10): 0.071

MAE (log10): 0.051

Ortalama tahmin hatası: yaklaşık %17.8

Bu sonuçlar, modelin ikinci el araç fiyatlarını yüksek doğrulukla tahmin ettiğini ve piyasa analizlerinde etkili bir araç olarak kullanılabileceğini göstermektedir.

En önemli tahminleyici değişkenler: Motor gücü, kilometre, araç yaşı, vites tipi ve yakıt türü olarak belirlenmiştir.

10. Genel Değerlendirme
Bu çalışma, gerçek dünya verisiyle desteklenen çok boyutlu bir analiz sunarak, Türkiye’deki ikinci el araç piyasasında:

Fiyat belirleyicilerini,

Bölgesel farklılıkları,

Fahiş fiyat eğilimlerini,

Satıcı profili etkilerini,

Ve fiyat tahmin modelinin başarısını bütüncül bir biçimde ortaya koymuştur.
